<% if @statement.countered_argument.present? %>
  <p class="countered-argument">Countering argument: <%= link_to @statement.countered_argument.one_line, @statement.countered_argument %></p>
<% end %>

<p class="statement-heading"><%= @statement.text %></p>
<%= render 'state', statement: @statement %>

<div class="stance argument-actions">
  <% if @statement.user == current_user %>
    <span class="date">Published by you</span>
  <% else %>
    <% if @stance %>
      You <%= @stance %>. &nbsp;
      <%= button_to 'Clear', no_stance_statement_path(@statement), class: 'link-button small-button' %>
      <%= link_to "New #{@stance.agree ? '' : 'counter'}argument", new_argument_path(argument: { subject_statement_id: @statement, agree: @stance.agree }), class: 'btn' %>
    <% else %>
      <%= button_to 'Agree', agree_statement_path(@statement), class: 'green' %>
      &nbsp;
      <%= button_to 'Disagree', disagree_statement_path(@statement), class: 'red' %>
    <% end %>
  <% end %>
</div>
<br />

<div class="arguments-table">
  <% [true, false].each do |side| %>
    <div class="agree-<%= side %>">
      <p><strong><%= side ? 'Supporting arguments' : 'Counterarguments' %></strong></p>
      <% if (arguments = @statement.arguments.where(agree: side, parent_argument_id: nil).published_or_by_user(current_user).vote_order).any? %>
        <% arguments.each do |argument| %>
          <div class="argument">
            <div><%= link_to argument.one_line, argument %></div>
            <div class="item-actions">
              <span><%= argument.published? ? "by #{argument.user.username}" : 'not yet published.' %></span>
              <% if argument.published? && @statement.agreed_by?(current_user) == side %>
                <% if current_user.upvoted_argument?(argument) %>
                  <%= button_to 'Remove vote', remove_vote_argument_path(argument), class: 'link-button small-button' %>
                <!-- limit to one vote per statement for now -->
                <% else %>
                  <%= button_to 'Upvote', upvote_argument_path(argument), class: 'link-button small-button' %>
                <% end %>
              <% elsif @statement.agreed_by?(current_user)&.send(:!=, side) %>
                <%= link_to 'Counter', counter_argument_path(argument), class: 'link-button small-button' %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <p>No responses.</p>
      <% end %>
      <br />
    </div>

  <% end %>
</div>
